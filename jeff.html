<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>You're a Sorting Hat, Harry!</title>
    <script src="libs/phaser-2.3.0.js"></script>
    <script src="libs/namey-api.js"></script>
    <script src="generators/text-gen.js"></script>
    <script src="data/event-data.js"></script>
    <script src="generators/event-gen.js"></script>
    <script src="generators/student-gen.js"></script>
    <script src="generators/house-gen.js"></script>
                                    
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
  </head>
<body>
    <script type="text/javascript">
    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
    
    var students = [];
    var houses = [];
    var events = [];
    var MAXNAMEREQUESTSIZE = 10;
    var NUMSTUDENTS = 25; //Make twice as many!
    var NUMHOUSES = 4;
    var studentsComplete = 0;
    var TOTALSTUDENTLOOPS = (Math.ceil(NUMSTUDENTS/MAXNAMEREQUESTSIZE))*2;
    var EVENTSPERYEAR = 10;
    var isLoaded = false;
    var houseFactory = new HouseFactory();
    var studentFactory = new StudentFactory();
    var eventFactory = new EventFactory();
        
    function preload() {
        
        //Generate Houses
        for (var i = 0; i < NUMHOUSES; i++) {
            houses.push(houseFactory.createHouse(null));
        }
        
        //Generate Students
        generateClass();
        
        //Grab an event
        events.push(eventFactory.createEvent(null));
        
    }
    
    function create() {

    }
        
    function update() {
        if (studentsComplete === TOTALSTUDENTLOOPS && isLoaded === false) {
            for (var i = 0; i < students.length; i++) {
                students[i].returnTextStats();
            }
            events[0].returnEvent();
            isLoaded = true;
        }
        if (isLoaded === true) {
          //Do all the update work in here.
          //console.log("Number of Students: " + students.length)
        }
    }
        
    function generateClass() {
        //Generate a new class of students and add them to a house.
        //Fetch male and female names
        for (var i = 0; i < NUMSTUDENTS; ) {
            var nameChunk = 0;
            if (NUMSTUDENTS - i > MAXNAMEREQUESTSIZE) {
                nameChunk = MAXNAMEREQUESTSIZE;
            }
            else {
                nameChunk = NUMSTUDENTS - i;
            }
            
            namey.get({ count: nameChunk, type: 'male', frequency: 'rare', with_surname: true, 
                        callback: function(n) { 
                            console.log(n);
                            var chunkSize = n.length;
                            for (var i = 0; i < chunkSize; i++) {
                                var newStudent = studentFactory.createStudent('male', n[i]); 
                                var houseNum = Math.floor(Math.random() * houses.length);
                                newStudent.house = houses[houseNum];
                                houses[houseNum].students.push(newStudent);
                                students.push(newStudent);
                            }
                            studentsComplete+=1;
                        }});
            namey.get({ count: nameChunk, type: 'female', frequency: 'rare', with_surname: true, 
                        callback: function(n) { 
                            console.log(n);
                            var chunkSize = n.length;
                            for (var i = 0; i < chunkSize; i++) {
                                var newStudent = studentFactory.createStudent('female', n[i]);
                                var houseNum = Math.floor(Math.random() * houses.length);
                                newStudent.house = houses[houseNum];
                                houses[houseNum].students.push(newStudent);
                                students.push(newStudent);
                            }
                            studentsComplete+=1;
                        }});
            
            i = i + nameChunk;
        }
    }
    
    </script>
  </body>
</html>

